---
title: "Bayesian Modeling and Prediction for Movies"
author: "Rohan Lewis"
date: "06/15/2020"
output: 
  html_document: 
    fig_width: 9
    highlight: pygments
    theme: spacelab
---

```{r, echo = FALSE}
knitr::opts_chunk$set(comment = NA)
options("scipen" = 100)

years <- c(1970, 1975, 1980, 1985, 1990, 1995, 2000, 2005, 2010)
```

```{r load-packages, message = FALSE, echo = FALSE}
library(ggplot2)
library(MASS)
library(dplyr)
library(statsr)
library(BAS)
library(GGally)
library(grid)
library(gridExtra)
library(ggridges)
library(expss)
library(tidyverse)
library(growthcurver)
library(xtable)
library(viridis)
```

```{r load-data, echo = FALSE}
load("movies.Rdata")
```

* * *

## Part 1: Data

From the Codebook, “The data set is comprised of 651 randomly sampled movies produced and released before 2016.”.

Because there were no details, I decided to plot a few variables to see how random this sample is.

```{r, echo = FALSE}
#Histogram.
sample_length <- max(movies$thtr_rel_year) - min(movies$thtr_rel_year) + 1
g1 <- ggplot(movies, aes(x = thtr_rel_year, fill = cut(thtr_rel_year, sample_length)))
g1 <- g1 + geom_histogram(bins = sample_length)
#Title.
g1 <- g1 + ggtitle(label = "Distribution by Year of 651 Randomly Sampled Movies")
#Viridis Color Scheme.
g1 <- g1 + scale_fill_viridis_d()
#X-axis.
g1 <- g1 + scale_x_continuous(name = "Theatrical Release Year",
                              breaks = years,
                              labels = years,
                              expand = c(0,0))
#Y-axis.
g1 <- g1 + scale_y_continuous(name = "Number of Movies")
                              
#Modify labels and text. Remove legend from left plot.
g1 <- g1 + theme(plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
                 axis.text.x = element_text(hjust = 1, size = 12, angle = 45),
                 axis.title.x = element_text(size = 14, face = "bold"),
                 axis.text.y = element_text(size = 12),
                 axis.title.y = element_text(size = 14, face = "bold"),
                 legend.position = "none")
g1
```

First as we see from above, the distribution of movies is from 1970 - 2014. More movies have been released in recent years, so skewed left is not unexpected.

I also took a look at the Oscar categories. The number of best actor wins (93) and best actress wins (72) is quite high for 651 movies. This leads me to believe that more well known, heavily advertised, and blockbuster films were more likely to be choosen from the sample. I would have to investigate the sampling method in more detail to draw a more concrete conclusion, but that is not the purpose of this project. I merely wanted a more indepth summary of the movies chosen.

```{r, echo = FALSE}
summary(movies %>%
          select(best_pic_nom,
                 best_pic_win,
                 best_actor_win,
                 best_actress_win,
                 best_dir_win,
                 top200_box))
```


This was an observational study, as no hypothesis, controls, nor confounding variables were specified beforehand. We can use this data to generalize and draw some trends in movies of the past 50 years, but not make definitive causal arguments.

* * *

## Part 2: Data manipulation

### Cleaning :

Here is an output of all NAs in the predictors.

```{r, echo = FALSE}
movies <- movies %>%
  select(title, title_type, genre, runtime, mpaa_rating,
         thtr_rel_year, thtr_rel_month, imdb_rating,
         imdb_num_votes, critics_score, audience_score,
         best_pic_nom, best_pic_win, best_actor_win,
         best_actress_win, best_dir_win, top200_box)

sapply(movies, function(x) sum(is.na(x)))

movies %>%
  filter(is.na(runtime)) %>%
  select(title, thtr_rel_year, runtime)
```

There exists a single NA in runtime for the 2008 Documentary "The End of America".  IMDb [provides](https://www.imdb.com/title/tt1294790/) a runtime of 74 minutes.

```{r, echo = FALSE}
movies[is.na(movies$runtime),]$runtime <- 74
```

### Title Type : Feature Film

The "feature_film" category is created from "title_type".

```{r, echo = FALSE}
movies <- movies %>%
  mutate(feature_film = ifelse(title_type == "Feature Film", " yes", "no"))
movies %>% group_by(title_type) %>% tally()
movies %>% group_by(feature_film) %>% tally()
```

### Genre : Drama

The "drama" category is created from "genre".


```{r, echo = FALSE}
movies <- movies %>%
  mutate(drama = ifelse(genre == "Drama", " yes", "no"))
movies %>% group_by(genre) %>% tally()
movies %>% group_by(drama) %>% tally()
```

### MPAA Rating : R

The "mpaa_rating_R" category is created from "mpaa_rating".

```{r, echo = FALSE}
movies <- movies %>%
  mutate(mpaa_rating_R = ifelse(mpaa_rating == "R", " yes", "no"))
movies %>% group_by(mpaa_rating) %>% tally()
movies %>% group_by(mpaa_rating_R) %>% tally()
```

### Theatrical Release Month : Oscar Season

The "oscar_season" category is created from October, November, and December from "thtr_rel_month".

```{r, echo = FALSE}
movies <- movies %>%
  mutate(oscar_season = ifelse(thtr_rel_month %in% 10:12, " yes", "no"))
movies %>% group_by(thtr_rel_month) %>% tally()
movies %>% group_by(oscar_season) %>% tally()
```

### Theatrical Release Month : Summer Season

The "summer_season" category is created from May, June, July, and August from "thtr_rel_month".

```{r, echo = FALSE}
movies <- movies %>%
  mutate(summer_season = ifelse(thtr_rel_month %in% 5:8, " yes", "no"))
movies %>% group_by(thtr_rel_month) %>% tally()
movies %>% group_by(summer_season) %>% tally()
```

* * *

## Part 3: Exploratory data analysis

For each of the five new variables, a relative distribution graph, table summary, and write-up is included. The graphs are relatively distributed by height within a value, but not amongst the values within a category.

For example, for the first new variable,  "feature_film", 591 of the movies are feature films, and only 60 are not.  The size of the two plots compared to each other does not account for that.

Vertical lines representing Q<sub>1</sub>, Median, and Q<sub>3</sub> are also shown.  The summary includes specific values to complement the graph.

<br>

```{r, echo = FALSE}
#Temp dataframe for summary statistics.
movies_eda <- movies %>%
  select(audience_score, feature_film, drama, mpaa_rating_R, oscar_season, summer_season) %>%
  apply_labels(audience_score = "Audience Score",
               feature_film = "Movie Type",
               feature_film = c("Feature Film" = " yes",
                                "Documentary or TV Movie" = "no"),
               
               drama = "Genre",
               drama = c("Drama" = " yes",
                         "Other Genre" = "no"),
               mpaa_rating_R = "MPAA Rating",
               mpaa_rating_R = c("Rated R" = " yes",
                                 "Other Rating" = "no"),
               oscar_season = "Theatrical Release Month (I)",
               oscar_season = c("Oscar Month" = " yes",
                                "Other Month" = "no"),
               summer_season = "Theatrical Release Month (II)",
               summer_season = c("Summer Month" = " yes",
                                 "Other Month" = "no"))
```

### Title Type : Feature Film

```{r, echo = FALSE, message = FALSE}
#Feature Film.

#Distribution Plot.
g3 <- ggplot(movies, aes(x = audience_score, y = feature_film))
#Densiy Ridges.
g3 <- g3 + stat_density_ridges(aes(fill = ..x..),
                               geom = "density_ridges_gradient",
                               quantile_lines = TRUE,
                               rel_min_height = 0.005,
                               scale = 1.25,
                               size = 0.5)
#Title.
g3 <- g3 + ggtitle("Movie Distribution by Audience Score and Film Type")
#X-axis
g3 <- g3 + scale_x_continuous("Rotten Tomatoes Audience Score", breaks = c(0, 25, 50, 75, 100))
#Y-axis.
g3 <- g3 + scale_y_discrete(name = "", limits = c("no", " yes"),
                            labels = c("Documentary\nor TV Movie", "Feature Film"))
#Viridis Color Scheme.
g3 <- g3 + scale_fill_viridis(name = "Audience\nScore", breaks = c(0, 25, 50, 75, 100),
                              guide = guide_colorbar(label.position = "left", hjust = 1))
#Modify labels and text.
g3 <- g3 + theme(plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
                 axis.text.x = element_text(size = 12),
                 axis.title.x = element_text(size = 14, face = "bold"),
                 axis.text.y = element_text(hjust = 1, size = 12, angle = 35),
                 axis.title.y = element_text(size = 14, face = "bold"),
                 legend.text = element_text(size = 12),
                 legend.title = element_text(hjust = 0.5, size = 14, face = "bold"))
g3

#Summary Statistics.
movies_eda %>% 
    tab_cells(audience_score) %>%
    tab_cols(total(), feature_film) %>% 
    tab_stat_unweighted_valid_n(label = "Count") %>%
    tab_stat_min() %>%
    tab_stat_median() %>%
    tab_stat_max() %>%
    tab_stat_mean %>%
    tab_stat_sd() %>%
    tab_pivot() %>% 
    set_caption("Table with Summary Statistics.")
```

Although most movies in the sample are Feature Films, the few Documentaries and TV Movies have a very high average Audience Score.  The Audience Score of Feature Films is spread wide, with two slight peaks at ~45 and ~80.

<br>

### Genre : Drama

```{r, echo = FALSE, message = FALSE}
#Drama.

#Distribution Plot.
g4 <- ggplot(movies, aes(x = audience_score, y = drama))
#Densiy Ridges.
g4 <- g4 + stat_density_ridges(aes(fill = ..x..),
                               geom = "density_ridges_gradient",
                               quantile_lines = TRUE,
                               rel_min_height = 0.005,
                               scale = 1.25,
                               size = 0.5)
#Title.
g4 <- g4 + ggtitle("Movie Distribution by Audience Score and Genre")
#X-axis
g4 <- g4 + scale_x_continuous("Rotten Tomatoes Audience Score", breaks = c(0, 25, 50, 75, 100))
#Y-axis.
g4 <- g4 + scale_y_discrete(name = "", limits = c("no", " yes"),
                            labels = c("Other Genre", "Drama"))
#Viridis Color Scheme.
g4 <- g4 + scale_fill_viridis(name = "Audience\nScore", breaks = c(0, 25, 50, 75, 100),
                              guide = guide_colorbar(label.position = "left", hjust = 1))
#Modify labels and text.
g4 <- g4 + theme(plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
                 axis.text.x = element_text(size = 12),
                 axis.title.x = element_text(size = 14, face = "bold"),
                 axis.text.y = element_text(hjust = 1, size = 12, angle = 35),
                 axis.title.y = element_text(size = 14, face = "bold"),
                 legend.text = element_text(size = 12),
                 legend.title = element_text(hjust = 0.5, size = 14, face = "bold"))
g4

#Summary Statistics.
movies_eda %>% 
    tab_cells(audience_score) %>%
    tab_cols(total(), drama) %>% 
    tab_stat_unweighted_valid_n(label = "Count") %>%
    tab_stat_min() %>%
    tab_stat_median() %>%
    tab_stat_max() %>%
    tab_stat_mean %>%
    tab_stat_sd() %>%
    tab_pivot() %>% 
    set_caption("Table with Summary Statistics.")
```

Almost half the movies in the sample are of genre Drama.  The Audience Scores are spread wide, and there is a prominent peak at ~80.  Movies of other genres are also spread wide, with two slight peaks at ~40 and ~85.

<br>

### MPAA Rating : R

```{r, echo = FALSE, message = FALSE}
#Rated-R.

#Distribution Plot.
g5 <- ggplot(movies, aes(x = audience_score, y = mpaa_rating_R))
#Densiy Ridges.
g5 <- g5 + stat_density_ridges(aes(fill = ..x..),
                               geom = "density_ridges_gradient",
                               quantile_lines = TRUE,
                               rel_min_height = 0.005,
                               scale = 1.25,
                               size = 0.5)
g5 <- g5 + ggtitle("Movie Distribution by Audience Score and MPAA Rating")
#X-axis
g5 <- g5 + scale_x_continuous("Rotten Tomatoes Audience Score", breaks = c(0, 25, 50, 75, 100))
#Y-axis.
g5 <- g5 + scale_y_discrete(name = "", limits = c("no", " yes"),
                            labels = c("Other Rating", "Rated R"))
#Viridis Color Scheme.
g5 <- g5 + scale_fill_viridis(name = "Audience\nScore", breaks = c(0, 25, 50, 75, 100),
                              guide = guide_colorbar(label.position = "left", hjust = 1))
#Modify labels and text.
g5 <- g5 + theme(plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
                 axis.text.x = element_text(size = 12),
                 axis.title.x = element_text(size = 14, face = "bold"),
                 axis.text.y = element_text(hjust = 1, size = 12, angle = 35),
                 axis.title.y = element_text(size = 14, face = "bold"),
                 legend.text = element_text(size = 12),
                 legend.title = element_text(hjust = 0.5, size = 14, face = "bold"))
g5

#Summary Statistics.
movies_eda %>% 
    tab_cells(audience_score) %>%
    tab_cols(total(), mpaa_rating_R) %>% 
    tab_stat_unweighted_valid_n(label = "Count") %>%
    tab_stat_min() %>%
    tab_stat_median() %>%
    tab_stat_max() %>%
    tab_stat_mean %>%
    tab_stat_sd() %>%
    tab_pivot() %>% 
    set_caption("Table with Summary Statistics.")
```

Similar to Drama, approximately half the movies in the sample have an MPAA Rating of R.  The Audience Scores are spread wide for movies that are Rated R, and there is a noticeable peak at ~40 and a prominent peak at ~80.  Movies of other MPAA Ratings are also spread wide, with noticeable peak at ~80.

<br>


### Theatrical Release Month : Oscar Season

```{r, echo = FALSE, message = FALSE}
#Oscar Season.

#Distribution Plot.
g6 <- ggplot(movies, aes(x = audience_score, y = oscar_season))
#Densiy Ridges.
g6 <- g6 + stat_density_ridges(aes(fill = ..x..),
                               geom = "density_ridges_gradient",
                               quantile_lines = TRUE,
                               rel_min_height = 0.005,
                               scale = 1.25,
                               size = 0.5)
#Title.
g6 <- g6 + ggtitle("Movie Distribution by Audience Score and Theatrical Release Month (I)")
#X-axis
g6 <- g6 + scale_x_continuous("Rotten Tomatoes Audience Score", breaks = c(0, 25, 50, 75, 100))
#Y-axis.
g6 <- g6 + scale_y_discrete(name = "", limits = c("no", " yes"),
                            labels = c("Other Month", "Oscar Month"))
#Viridis Color Scheme.
g6 <- g6 + scale_fill_viridis(name = "Audience\nScore", breaks = c(0, 25, 50, 75, 100),
                              guide = guide_colorbar(label.position = "left", hjust = 1))
#Modify labels and text.
g6 <- g6 + theme(plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
                 axis.text.x = element_text(size = 12),
                 axis.title.x = element_text(size = 14, face = "bold"),
                 axis.text.y = element_text(hjust = 1, size = 12, angle = 35),
                 axis.title.y = element_text(size = 14, face = "bold"),
                 legend.text = element_text(size = 12),
                 legend.title = element_text(hjust = 0.5, size = 14, face = "bold"))
#Footnote.
g6 <- g6 + labs(caption = "October, November, and December are Oscar Months.")
g6

#Summary Statistics.
movies_eda %>% 
    tab_cells(audience_score) %>%
    tab_cols(total(), oscar_season) %>% 
    tab_stat_unweighted_valid_n(label = "Count") %>%
    tab_stat_min() %>%
    tab_stat_median() %>%
    tab_stat_max() %>%
    tab_stat_mean %>%
    tab_stat_sd() %>%
    tab_pivot() %>% 
    set_caption("Table with Summary Statistics.")
```

The distribution of Audience Scores for movies during Oscar Months and non-Oscar Months is very similar to that of movies Rated R and those that are not.   Movies during Oscar Months have a noticeable peak at ~45 and a prominent peak at ~80.  Movies released during other months have a noticeable peak at ~80.

<br>

### Theatrical Release Month : Summer Season

```{r, echo = FALSE, message = FALSE}
#Summer Season.

#Distribution Plot.
g7 <- ggplot(movies, aes(x = audience_score, y = summer_season))
#Densiy Ridges.
g7 <- g7 + stat_density_ridges(aes(fill = ..x..),
                               geom = "density_ridges_gradient",
                               quantile_lines = TRUE,
                               rel_min_height = 0.005,
                               scale = 1.25,
                               size = 0.5)
#Title. 
g7 <- g7 + ggtitle("Movie Distribution by Audience Score and Theatrical Release Month (II)")
#X-axis
g7 <- g7 + scale_x_continuous("Rotten Tomatoes Audience Score", breaks = c(0, 25, 50, 75, 100))
#Y-axis.
g7 <- g7 + scale_y_discrete(name = "", limits = c("no", " yes"),
                            labels = c("Other Month", "Summer Month"))
#Viridis Color Scheme.
g7 <- g7 + scale_fill_viridis(name = "Audience\nScore", breaks = c(0, 25, 50, 75, 100),
                              guide = guide_colorbar(label.position = "left", hjust = 1))
#Modify labels and text.
g7 <- g7 + theme(plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
                 axis.text.x = element_text(size = 12),
                 axis.title.x = element_text(size = 14, face = "bold"),
                 axis.text.y = element_text(hjust = 1, size = 12, angle = 35),
                 axis.title.y = element_text(size = 14, face = "bold"),
                 legend.text = element_text(size = 12),
                 legend.title = element_text(hjust = 0.5, size = 14, face = "bold"))
#Footnote.
g7 <- g7 + labs(caption = "May, June, July, and August are Summer Months.")
g7

#Summary Statistics.
movies_eda %>% 
    tab_cells(audience_score) %>%
    tab_cols(total(), summer_season) %>% 
    tab_stat_unweighted_valid_n(label = "Count") %>%
    tab_stat_min() %>%
    tab_stat_median() %>%
    tab_stat_max() %>%
    tab_stat_mean %>%
    tab_stat_sd() %>%
    tab_pivot() %>% 
    set_caption("Table with Summary Statistics.")
```

Almost a third of the movies are released during the summer months.  In my opinion, summer movies tend be heavily advertised, action/adventure movies, and often sequels, that are highly anticipated.  They tend to make money and are popular, as children are not in school, however they are not necessarily ranked highly as favorite movies.  Notice that the prominent peak for Summer Months is ~70, a bit less than the prominent peak for other variables.  Non-summer months have a slight peak at ~50 and a noticeable peak at ~80.

### Summary of New Variables.

The new variables have similar spreads, regardless of value taken.  Almost all tend to have an interquartile range around 45 to 80, and almost all have a median and mean around 60 to 70.  People tend to vote for movies they like, which explains the usually medium to prominent peak on the right.  This lack of difference is not optimal for regression.

The noted exception is Documentary and TV Movies (non-feature films) tend rank very high on audience score.  The prominent peak and noticeably higher Q<sub>1</sub>, Median, Mean, and Q<sub>3</sub> values can attest to this.

### Numerical Predictors.

```{r, echo = FALSE, message = FALSE}
numericals <- movies %>%
  select(audience_score, critics_score, imdb_rating, imdb_num_votes, runtime, thtr_rel_year)
ggcorr(numericals) + scale_fill_viridis(direction = -1)
```

Looking at the correlation of the numerical variables, the Audience Score and Critics Score for Rotten Tomatoes do disagree, but have a high degree of correlation.  Sometimes Summer blockbusters with action and heavy advertisement are rated highly by audiences, but critics are more particular about the acting and writing.  Conversely, sometimes very well made movies that critics vote highly are dismissed as boring by the audience.

It is also apparent that Rotten Tomatoes Audience Score and IMDb Ranking are very highly correlated. For all practical purposes, they are measuring the same value in a different metric on different websites.  

Critics Score and IMDb Ranking are highly correlated as well.  To eliminate collinearity, I am eliminating IMDb Ranking from the model.  I am also eliminating the number of votes on IMDb as well.  I am doing a model as if IMDb did not exist.  How people perceive the movie should not change because of that.

* * *

## Part 4: Modeling

### Variables for Model:

Currently the predictors being considered for Audience Score are:

```{r, echo = FALSE}
movies_2 <- movies %>%
  select(audience_score, feature_film, drama, runtime,
         mpaa_rating_R, thtr_rel_year, oscar_season,
         summer_season, critics_score, best_pic_nom,
         best_pic_win, best_actor_win, best_actress_win,
         best_dir_win, top200_box)

colnames(movies_2)[-1]
```

Here is the full model from a standard linear regression.

```{r, echo = FALSE}
movies_full <- lm(audience_score ~ ., data = movies_2)

summary(movies_full)
```

### Model Selection Choice and Process:

Many coefficients of the predictors for the above full regression model are not statistically significant.  Therefore, I used Bayesian Adaptive Sampling Linear Regression Model with a Zellner-Siow Cauchy prior, a uniform assignment of those probabilities, and Markov Chain Monte Carlo.  I used the ZS-null as it is widely used for BAS.  I used MCMC as We do not know the posterior model probabilities, yet we can can calulate the ratio between the two posterior models, as well as its usefulness for so many predictors that cannot all be enumerated.

### Model diagnostics

```{r, echo = FALSE}
#Regression Model.
movies.ZS <- bas.lm(audience_score ~ .,
                    data = movies_2,
                    prior = "ZS-null",
                    modelprior = uniform(),
                    method = "MCMC")
```

```{r, fig.height = 4, echo = FALSE}
#Convergence Plot.
#Equivalent of diagnostics(movies.ZS, ask = F).
g8 <- ggplot(mapping = aes(x = movies.ZS$probne0.RN, y = movies.ZS$probne0.MCMC))
#Scatter Plot.
g8 <- g8 + geom_point(color = viridis(5)[3], size = 4, alpha = 0.5)
#y = x.
g8 <- g8 + geom_segment(aes(x = 0, y = 0, xend = 1.05, yend = 1.05), color = viridis(5)[1])
#Title. 
g8 <- g8 + ggtitle("Convergence Plot: Posterior Inclusion Probabilities")
#X-axis
g8 <- g8 + scale_x_continuous("pip (renormalized)",
                              breaks = c(0, 0.2, 0.4, 0.6, 0.8, 1.0),
                              expand = c(0,0))
#Y-axis.
g8 <- g8 + scale_y_continuous("pip (MCMC)",
                              breaks = c(0, 0.2, 0.4, 0.6, 0.8, 1.0),
                              expand = c(0,0))
#Modify labels and text.
g8 <- g8 + theme(plot.title = element_text(hjust = 0.5, size = 12, face = "bold"),
                 axis.text.x = element_text(size = 10),
                 axis.title.x = element_text(size = 12, face = "bold"),
                 axis.text.y = element_text(hjust = 1, size = 10, angle = 35),
                 axis.title.y = element_text(size = 12, face = "bold"))

#Convergence Plot.
g9 <- ggplot(mapping = aes(movies.ZS$postprobs.RN, y = movies.ZS$postprobs.MCMC))
#Scatter Plot.
g9 <- g9 + geom_point(color = viridis(5)[3], size = 4, alpha = 0.5)
#y = x.
g9 <- g9 + geom_segment(aes(x = -0.005, y = -0.005, xend = 0.2, yend = 0.2), color = viridis(5)[1])
#Title. 
g9 <- g9+ ggtitle("Convergence Plot: Posterior Model Probabilities")
#X-axis
g9 <- g9 + scale_x_continuous("p(M | Y) (renormalized)",
                              breaks = c(0, 0.05, 0.10, 0.15, 0.20),
                              expand = c(0,0))
#Y-axis.
g9 <- g9 + scale_y_continuous("p(M | Y) (MCMC)",
                              breaks = c(0, 0.05, 0.10, 0.15, 0.20),
                              expand = c(0,0))
#Modify labels and text.
g9 <- g9 + theme(plot.title = element_text(hjust = 0.5, size = 12, face = "bold"),
                 axis.text.x = element_text(size = 10),
                 axis.title.x = element_text(size = 12, face = "bold"),
                 axis.text.y = element_text(hjust = 1, size = 10, angle = 35),
                 axis.title.y = element_text(size = 12, face = "bold"))


grid.arrange(g8, g9, ncol = 2)
```

On the Posterior Inclusion Probabilities Plot on the left, the renormalized marginal likelihoods time prior are virtually identical to the relative Monte Carlo frequencies of sampled models for each variable.

Simililarly, on the Posterior Model Probabilities Plot on the right, the renormalized marginal likelihoods time prior are virtually identical to the relative Monte Carlo frequencies of sampled models for each model.

Since both plots exhibit convergence, it can be safely assumed that the MCMC simulation has been run a sufficient number of times.

```{r, fig.height = 6, echo = FALSE, message = FALSE, warning = FALSE}
#Residuals and Fitted Data.
test <- predict(movies.ZS, movies_2)
temp_df <- data.frame(test$fit) %>%
  mutate(residuals = movies_2$audience_score - test$fit) %>%
  `colnames<-`(c("fitted", "residuals")) %>%
  mutate(outliers = ifelse(residuals >= 2.9*sd(residuals), "yes", "no"))

#Residuals vs Fitted Plot.
#Equivalent of plot(movies.ZS, which = 1, ask = F).
g10 <- ggplot(data = temp_df, mapping = aes(x = fitted, y = residuals))
#Scatter Plot.
g10 <- g10 + geom_point(aes(color = outliers, alpha = outliers), size = 4)
#Best Fit.
g10 <- g10 + stat_smooth(method = "lm", color = viridis(5)[1], se = FALSE)
#Title. 
g10 <- g10 + ggtitle("Residuals vs Fitted")
#X-axis
g10 <- g10 + scale_x_continuous("Predictions under BMA\nbas.lm(audience_score ~.)")
#Y-axis.
g10 <- g10 + scale_y_continuous("Residuals")
#Viridis Color Scheme
g10 <- g10 + scale_color_manual(values = c(viridis(5)[3], viridis(7)[3]))
g10 <- g10 + scale_alpha_manual(values = c(0.2, 1))
#Modify labels and text.
g10 <- g10 + theme(plot.title = element_text(hjust = 0.5, size = 12, face = "bold"),
                   axis.text.x = element_text(size = 8),
                   axis.title.x = element_text(size = 10, face = "bold"),
                   axis.text.y = element_text(hjust = 1, size = 8, angle = 35),
                   axis.title.y = element_text(size = 10, face = "bold"),
                   legend.position = "none")

#Model Probabilities Data.
temp_df <- data.frame("Probability" = movies.ZS$postprobs) %>%
  mutate(n = 1:length(movies.ZS$postprobs),
         Cumulative = cumsum(Probability))

logistic_model <- SummarizeGrowth(temp_df$n, temp_df$Cumulative)
df.pred <-  data.frame(n = 1:length(movies.ZS$postprobs),
                       Cumulative = predict(logistic_model$model))

#Model Probabilities.
#Equivalent of plot(movies.ZS, which = 2, ask = F).
g11 <- ggplot(data = temp_df, mapping = aes(x = n, y = Cumulative))
#Scatter Plot.
g11 <- g11 + geom_point(color = viridis(5)[3], size = 4, alpha = 0.5)
#Best Fit.
g11 <- g11 + geom_line(df.pred, mapping = aes(y = df.pred[, 2]), color = viridis(5)[1], size = 1.2)

#Title. 
g11 <- g11 + ggtitle("Model Probabilities")
#X-axis
g11 <- g11 + scale_x_continuous("Model Search Order by Probability\nbas.lm(audience_score ~.)")
#Y-axis.
g11 <- g11 + scale_y_continuous("Cumulative Probability")
#Modify labels and text.
g11 <- g11 + theme(plot.title = element_text(hjust = 0.5, size = 12, face = "bold"),
                   axis.text.x = element_text(size = 8),
                   axis.title.x = element_text(size = 10, face = "bold"),
                   axis.text.y = element_text(hjust = 1, size = 8, angle = 35),
                   axis.title.y = element_text(size = 10, face = "bold"))

#Model Complexity Data.
temp_df <- data.frame("logmarg" = movies.ZS$logmarg,
                      "size" = movies.ZS$size)
#Model Complexity.
#Equivalent of plot(movies.ZS, which = 3, ask = F).
g12_1 <- ggplot(data = temp_df %>% filter(logmarg > 75), mapping = aes(x = size, y = logmarg))
g12_2 <- ggplot(data = temp_df %>% filter(logmarg < 75), mapping = aes(x = size, y = logmarg))

#Scatter Plot.
g12_1 <- g12_1 + geom_point(color = viridis(5)[3], size = 4, alpha = 0.3)
g12_2 <- g12_2 + geom_point(color = viridis(5)[3], size = 4, alpha = 0.3)
#Title. 
g12_1 <- g12_1 + ggtitle("Model Complexity")
#X-axis.
g12_1 <- g12_1 + scale_x_continuous(limits = c(0, 11),
                                    breaks = c(0, 2, 4, 6, 8, 10))
g12_2 <- g12_2 + scale_x_continuous("Model Dimension\nbas.lm(audience_score ~.)",
                                    limits = c(0, 11),
                                    breaks = c(0, 2, 4, 6, 8, 10))
#Y-axis.
g12_1 <- g12_1 + scale_y_continuous("log(Marginal)")
g12_2 <- g12_2 + scale_y_continuous("", breaks = c(0, 30, 60))
#Modify labels and text.
g12_1 <- g12_1 + theme(plot.title = element_text(hjust = 0.5, size = 12, face = "bold"),
                       axis.text.x = element_blank(),
                       axis.ticks.x = element_blank(),
                       axis.title.x = element_blank(),
                       axis.text.y = element_text(hjust = 1, size = 8, angle = 35),
                       axis.title.y = element_text(hjust = 0, size = 10, face = "bold"))

g12_2 <- g12_2 + theme(plot.title = element_blank(),
                       axis.text.x = element_text(size = 8),
                       axis.title.x = element_text(size = 10, face = "bold"),
                       axis.text.y = element_text(hjust = 1, size = 8, angle = 35),
                       panel.grid.minor.y = element_blank(),
                       axis.title.y = element_text(size = 10, face = "bold"))

g12 <- arrangeGrob(g12_1, g12_2, layout_matrix = matrix(c(1,1,2), ncol = 1))

#Inclusion Probabilities Data.
temp_df <- data.frame("Predictor" = factor(movies.ZS$names),
                      "Probability" = movies.ZS$probne0) %>%
   mutate(Predictor = fct_rev(fct_relevel(Predictor, movies.ZS$names)),
         Highlight = ifelse(Probability > 0.6, "yes", "no"))
#Inclusion Probabilities.
#Equivalent of plot(movies.ZS, which = 4, ask = F).
g13 <- ggplot(data = temp_df, mapping = aes(x = Probability, y = Predictor))
#Horizontal Lines.
g13 <- g13 + geom_segment(aes(x = 0, y = Predictor, xend = Probability, yend = Predictor, color = Highlight, size = Highlight))
#Title. 
g13 <- g13 + ggtitle("Inclusion Probabilities")
#X-axis
g13 <- g13 + scale_x_continuous("Marginal Inclusion Probability")
#Y-axis.
g13 <- g13 + scale_y_discrete("bas.lm(audience_score ~.)")
#Viridis Color Scheme.
g13 <- g13 + scale_color_manual(values = c(viridis(5)[1], viridis(5)[3]))
#Scale Size.
g13 <- g13 + scale_size_manual(values = c(1, 3))
#Y-axis labels.
fontcolor <- rev(ifelse(temp_df$Highlight == "yes", viridis(5)[3], viridis(5)[1]))
fontface <- rev(ifelse(temp_df$Highlight == "yes", "bold", "plain"))
#Modify labels and text.
g13 <- g13 + theme(plot.title = element_text(hjust = 0.5, size = 12, face = "bold"),
                   axis.text.x = element_text(size = 8),
                   axis.title.x = element_text(size = 10, face = "bold"),
                   axis.text.y = element_text(hjust = 1, size = 8, angle = 35, color = fontcolor, face = fontface),
                   axis.title.y = element_text(size = 10, face = "bold"),
                   legend.position = "none")

grid.arrange(g10, g11, g12, g13,
             layout_matrix = matrix(rbind(c(1, 1, 1, 1, 1, NA, 2, 2, 2, 2, 2),
                                          c(3, 3, 3, 3, 3, NA, 4, 4, 4, 4, 4)),
                                    ncol = 11))
```

From the Residuals vs Fitted Plot, the spread is reasonably constant over the domain of fitted values by Bayesian Model Averaging.  The three outliers are highlighted, as well as the regression line, which is virtually identical to the horizontal line y = 0.

From the Cumulative Model Probabilities Plot, there are about 1,900 unique models with MCMC sampling.  About 100 models contribute to 90% of the probability, with the rest leveling off and individually not contributing much to the total.

From the Model Complexity Plot, the highest Bayes Factors coincide with four or five predictors.

From the Inclusion Probabilities Plot, it is evident that the Intercept, Feature Film, Critics Score, and Best Picture Nomination have PIPs greater than 0.5, indicating they are consistently important in models for predicting the Audience Score. Runtime and 

```{r, echo = FALSE}
#Variables in Best Models.
image(movies.ZS, rotate = F)
```

Here is a visual of the top 20 models and the respective variables that are included in each model.

```{r, echo = FALSE}
summary(movies.ZS)
```

The first column of the above summary is the Marginal Inclusion Probabilities.  The other columns correspond to the variables included in the first five models.  Notice that model 1 only includes the 4 variables with Marginal Inclusion Probabilities > 5.  Apart from Intercept, these are the most significant preditors from the initial general model.  The other two significant predictors are dramano and runtime, which are the next two variables with the highest Marginal Inclusion Probabilies.  These two variables are  included in some of models 2, 3, and 4.  

### Interpretation of Model Coefficients

```{r, echo = FALSE}
confint(coef(movies.ZS))
```

The intercept of the regression model is 61.27 - 63.41, which would is the 95% credible interval for the Audience Score of a movie that :
1) is a Feature Film,
2) is of genre Drama,
3) is 0 minutes long,
4) has an MPAA Rating of R,
5) was released in year 0,
6) was (hypothetically) released during both Oscar and Summer Season (at least one will be false for every movie, as they are mutually exclusive),
7) has a Rotten Tomatoes Critics Score of 0,
8) was not nominated nor won Best Picture,
9) the actors in the movie have not won Best Actor,
10) the actresses in the movie have not won Best Actress,
11) the director of the movie has not won Best Director, and
12) is not in the Top 200 Box Office Movies of All Time.

#### Most Significant Predictors

These are the predictors that have Marginal Inclusion Probabilities greater than 0.5 and are included in most of the top 20 models.

If a movie is not a Feature Film, 95% of those corresponding Audience Scores would increase by 0.00 - 10.21.

For each 1 point increase of Rotten Tomatoes Critics Score, 95% of those corresponding Audience Scores would increase by 0.42 - 0.51.

If a movie was nominted for Best Picture, 95% of those corresponding Audience Scores would increase by 0.00 - 14.21.

#### Slightly Significant Predictors

These are the predictors that have Marginal Inclusion Probabilities slightly less than 0.5 and are included in some of the top 20 models.

If a movie is not a Drama, 95% of those corresponding Audience Scores would decrease by 0.00 - 3.44.

For each minute in the runtime of the movie, 95% of those corresponding Audience Scores would increase by 0.00 - 0.11.

#### Other Predictors.

These are the predictors that have Marginal Inclusion Probabilities much less than 0.5 and are included in very few if any of the top 20 models.

If a movie is not Rated R, 95% of those corresponding Audience Scores would decrease by 0.16 to increase by 0.27.

For every year the movie is released after year 0, 95% of those corresponding Audience Scores would decrease by 0.014 to increase by 0.048.

If a movie was not released during Oscar Season, 95% of those corresponding Audience Scores would decrease by 0.52 to increase by 0.040.

If a movie was not released during Summer Season, 95% of those corresponding Audience Scores would decrease by 0.067 to increase by 0.63.

If a movie won Best Picture, 95% of those corresponding Audience Scores would decrease by 2.69 to increase by 1.43.

If an actor in the movie had won Best Actor at any time, 95% of those corresponding Audience Scores would decrease by 1.77 to increase by 0.075.

If an actress in the movie had won Best Actress at any time, 95% of those corresponding Audience Scores would decrease by 2.43 to increase by 0.0013.

If the director of the movie had won Best Director at any time, 95% of those corresponding Audience Scores would decrease by 0.037 to increase by 0.75.

If movie is in the Top 200 Box Office Movies of All Time, 95% of those corresponding Audience Scores would decrease by 0.00052 to increase by 4.15.

* * *

## Part 5: Prediction

```{r, echo = FALSE}
#Deadpool data from https://www.imdb.com/title/tt1431045/ and https://www.rottentomatoes.com/m/deadpool.

deadpool <- data.frame("audience_score" = 90,
                       "feature_film" = " yes",
                       "drama" = "no",
                       "runtime" = 108,
                       "mpaa_rating_R" = " yes",
                       "thtr_rel_year" = 2016,
                       "oscar_season" = "no",
                       "summer_season" = "no",
                       "critics_score" = 85,
                       "best_pic_nom" = "no",
                       "best_pic_win" = "no",
                       "best_actor_win" = "no",
                       "best_actress_win" = "no",
                       "best_dir_win" = "no",
                       "top200_box" = "yes")
```

Deadpool, having an Audience Score of 90%, was an 108 minute long, Rated-R, Action Adventure (non Drama) Feature Film released in neither Summer nor Oscar Season of 2016, that has a [Critics Score of 85%](https://www.rottentomatoes.com/m/deadpool), that was never nominated for any Oscars, but is [ranked #171 by Box Office](https://www.boxofficemojo.com/chart/top_lifetime_gross_adjusted/?adjust_gross_to=2020&ref_=bo_cso_ac) .
```{r, echo = FALSE}
BPM <- predict(movies.ZS, newdata = deadpool, estimator = "BPM", interval = "prediction", se.fit = TRUE)
confint(BPM)
variable.names(BPM)
```

Using a Best Prediction Model, the 95% credible interval for the Audience Score of any 108 minute long, Rated-R, Feature Film released in 2016, that has a Critics Score of 85%, and has never won Best Picture is between 46.40 and 100 (as 100 is the highest score).  Deadpool, at 90%, lies in this interval.  Notice that these numbers are extremely similar for the Median Prediction Model.

```{r, echo = FALSE}
HPM <- predict(movies.ZS, newdata = deadpool, estimator = "HPM", interval = "prediction", se.fit = TRUE)
confint(HPM)
variable.names(HPM)
```

* * *

## Part 6: Conclusion

Including the intercept, there are four main predictors, two somewhat important predictors, and several that add very little to the model average.

The credible intervals are extremely wide.  More data and relevant predictors would be necessary to tighten the predicted values.

I have already mentioned reservations about the sampling.  More movies across a larger span of time could possibly provide a better sample for prediction.

It is important to note we did not differentiate the among movies that are not Feature Films.  This is also true for movies that are not Genres, as well as movies not Rated R.  We grouped the months, but did not look at months individually.

I think directors and studio could possibly influence rating, but they were not included in the model.

Box Office Earnings could possibly influence rating.  That metric was not included in the original dataset.

It is important to note none of these variables have been shown to be causal in affecting the Audience Score.  We can only predict an interval of scores based on the characteristics of the movie that have been shown to show trends from our sample of 651 movies.

# Appendix

All code for each Part is included here.

## Setup

```{r, eval = FALSE}
knitr::opts_chunk$set(comment = NA)
options("scipen" = 100)

years <- c(1970, 1975, 1980, 1985, 1990, 1995, 2000, 2005, 2010)
```

### Load packages

```{r, eval = FALSE}
library(ggplot2)
library(MASS)
library(dplyr)
library(statsr)
library(BAS)
library(grid)
library(gridExtra)
library(ggridges)
library(expss)
library(viridis)
```

### Load data

```{r, eval = FALSE}
load("movies.Rdata")
```

* * *

## Part 1: Data

Plot : Distribution by Year of 651 Randomly Sampled Movies

```{r, eval = FALSE}
#Histogram.
sample_length <- max(movies$thtr_rel_year) - min(movies$thtr_rel_year) + 1
g1 <- ggplot(movies, aes(x = thtr_rel_year, fill = cut(thtr_rel_year, sample_length)))
g1 <- g1 + geom_histogram(bins = sample_length)
#Title.
g1 <- g1 + ggtitle(label = "Distribution by Year of 651 Randomly Sampled Movies")
#Viridis Color Scheme.
g1 <- g1 + scale_fill_viridis_d()
#X-axis.
g1 <- g1 + scale_x_continuous(name = "Theatrical Release Year",
                              breaks = years,
                              labels = years,
                              expand = c(0,0))
#Y-axis.
g1 <- g1 + scale_y_continuous(name = "Number of Movies")
                              
#Modify labels and text. Remove legend from left plot.
g1 <- g1 + theme(plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
                 axis.text.x = element_text(hjust = 1, size = 12, angle = 45),
                 axis.title.x = element_text(size = 14, face = "bold"),
                 axis.text.y = element_text(size = 12),
                 axis.title.y = element_text(size = 14, face = "bold"),
                 legend.position = "none")
g1
```

Summary: Oscar Categories and Top 200 Boxoffice

```{r, eval = FALSE}
summary(movies %>%
          select(best_pic_nom,
                 best_pic_win,
                 best_actor_win,
                 best_actress_win,
                 best_dir_win,
                 top200_box))
```

* * *

## Part 2: Data manipulation

### Cleaning :

```{r, eval = FALSE}
movies <- movies %>%
  select(title, title_type, genre, runtime, mpaa_rating,
         thtr_rel_year, thtr_rel_month, imdb_rating,
         imdb_num_votes, critics_score, audience_score,
         best_pic_nom, best_pic_win, best_actor_win,
         best_actress_win, best_dir_win, top200_box)
```


```{r, eval = FALSE}
#Determine NAs
sapply(movies, function(x) sum(is.na(x)))

#Update Runtime for "The End of America"
movies %>%
  filter(is.na(runtime)) %>%
  select(title, thtr_rel_year, runtime)

movies[is.na(movies$runtime),]$runtime <- 74
```

### Title Type : Feature Film

```{r, eval = FALSE}
movies <- movies %>%
  mutate(feature_film = ifelse(title_type == "Feature Film", " yes", "no"))
movies %>% group_by(title_type) %>% tally()
movies %>% group_by(feature_film) %>% tally()
```

### Genre : Drama

```{r, eval = FALSE}
movies <- movies %>%
  mutate(drama = ifelse(genre == "Drama", " yes", "no"))
movies %>% group_by(genre) %>% tally()
movies %>% group_by(drama) %>% tally()
```

### MPAA Rating : R

```{r, eval = FALSE}
movies <- movies %>%
  mutate(mpaa_rating_R = ifelse(mpaa_rating == "R", " yes", "no"))
movies %>% group_by(mpaa_rating) %>% tally()
movies %>% group_by(mpaa_rating_R) %>% tally()
```

### Theatrical Release Month : Oscar Season

```{r, eval = FALSE}
movies <- movies %>%
  mutate(oscar_season = ifelse(thtr_rel_month %in% 10:12, " yes", "no"))
movies %>% group_by(thtr_rel_month) %>% tally()
movies %>% group_by(oscar_season) %>% tally()
```

### Theatrical Release Month : Summer Season

```{r, eval = FALSE}
movies <- movies %>%
  mutate(summer_season = ifelse(thtr_rel_month %in% 5:8, " yes", "no"))
movies %>% group_by(thtr_rel_month) %>% tally()
movies %>% group_by(summer_season) %>% tally()
```

* * *

## Part 3: Exploratory data analysis

```{r, eval = FALSE}
#Temp dataframe for summary statistics.
movies_eda <- movies %>%
  select(audience_score, feature_film, drama, mpaa_rating_R, oscar_season, summer_season) %>%
  apply_labels(audience_score = "Audience Score",
               feature_film = "Movie Type",
               feature_film = c("Feature Film" = " yes",
                                "Documentary or TV Movie" = "no"),
               
               drama = "Genre",
               drama = c("Drama" = " yes",
                         "Other Genre" = "no"),
               mpaa_rating_R = "MPAA Rating",
               mpaa_rating_R = c("Rated R" = " yes",
                                 "Other Rating" = "no"),
               oscar_season = "Theatrical Release Month (I)",
               oscar_season = c("Oscar Month" = " yes",
                                "Other Month" = "no"),
               summer_season = "Theatrical Release Month (II)",
               summer_season = c("Summer Month" = " yes",
                                 "Other Month" = "no"))
```

### Title Type : Feature Film

Output : Plot and Table Summary for Feature Film

```{r, eval = FALSE}
#Feature Film.

#Distribution Plot.
g3 <- ggplot(movies, aes(x = audience_score, y = feature_film))
#Densiy Ridges.
g3 <- g3 + stat_density_ridges(aes(fill = ..x..),
                               geom = "density_ridges_gradient",
                               quantile_lines = TRUE,
                               rel_min_height = 0.005,
                               scale = 1.25,
                               size = 0.5)
#Title.
g3 <- g3 + ggtitle("Movie Distribution by Audience Score and Film Type")
#X-axis
g3 <- g3 + scale_x_continuous("Rotten Tomatoes Audience Score", breaks = c(0, 25, 50, 75, 100))
#Y-axis.
g3 <- g3 + scale_y_discrete(name = "", limits = c("no", " yes"),
                            labels = c("Documentary\nor TV Movie", "Feature Film"))
#Viridis Color Scheme.
g3 <- g3 + scale_fill_viridis(name = "Audience\nScore", breaks = c(0, 25, 50, 75, 100),
                              guide = guide_colorbar(label.position = "left", hjust = 1))
#Modify labels and text.
g3 <- g3 + theme(plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
                 axis.text.x = element_text(size = 12),
                 axis.title.x = element_text(size = 14, face = "bold"),
                 axis.text.y = element_text(hjust = 1, size = 12, angle = 35),
                 axis.title.y = element_text(size = 14, face = "bold"),
                 legend.text = element_text(size = 12),
                 legend.title = element_text(hjust = 0.5, size = 14, face = "bold"))
g3

#Summary Statistics.
movies_eda %>% 
    tab_cells(audience_score) %>%
    tab_cols(total(), feature_film) %>% 
    tab_stat_unweighted_valid_n(label = "Count") %>%
    tab_stat_min() %>%
    tab_stat_median() %>%
    tab_stat_max() %>%
    tab_stat_mean %>%
    tab_stat_sd() %>%
    tab_pivot() %>% 
    set_caption("Table with Summary Statistics.")
```

### Genre : Drama

Output : Plot and Table Summary for Feature Film

```{r, eval = FALSE}
#Drama.

#Distribution Plot.
g4 <- ggplot(movies, aes(x = audience_score, y = drama))
#Densiy Ridges.
g4 <- g4 + stat_density_ridges(aes(fill = ..x..),
                               geom = "density_ridges_gradient",
                               quantile_lines = TRUE,
                               rel_min_height = 0.005,
                               scale = 1.25,
                               size = 0.5)
#Title.
g4 <- g4 + ggtitle("Movie Distribution by Audience Score and Genre")
#X-axis
g4 <- g4 + scale_x_continuous("Rotten Tomatoes Audience Score", breaks = c(0, 25, 50, 75, 100))
#Y-axis.
g4 <- g4 + scale_y_discrete(name = "", limits = c("no", " yes"),
                            labels = c("Other Genre", "Drama"))
#Viridis Color Scheme.
g4 <- g4 + scale_fill_viridis(name = "Audience\nScore", breaks = c(0, 25, 50, 75, 100),
                              guide = guide_colorbar(label.position = "left", hjust = 1))
#Modify labels and text.
g4 <- g4 + theme(plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
                 axis.text.x = element_text(size = 12),
                 axis.title.x = element_text(size = 14, face = "bold"),
                 axis.text.y = element_text(hjust = 1, size = 12, angle = 35),
                 axis.title.y = element_text(size = 14, face = "bold"),
                 legend.text = element_text(size = 12),
                 legend.title = element_text(hjust = 0.5, size = 14, face = "bold"))
g4

#Summary Statistics.
movies_eda %>% 
    tab_cells(audience_score) %>%
    tab_cols(total(), drama) %>% 
    tab_stat_unweighted_valid_n(label = "Count") %>%
    tab_stat_min() %>%
    tab_stat_median() %>%
    tab_stat_max() %>%
    tab_stat_mean %>%
    tab_stat_sd() %>%
    tab_pivot() %>% 
    set_caption("Table with Summary Statistics.")
```

### MPAA Rating : R

Output : Plot and Table Summary for MPAA Rating R

```{r, eval = FALSE}
#Rated-R.

#Distribution Plot.
g5 <- ggplot(movies, aes(x = audience_score, y = mpaa_rating_R))
#Densiy Ridges.
g5 <- g5 + stat_density_ridges(aes(fill = ..x..),
                               geom = "density_ridges_gradient",
                               quantile_lines = TRUE,
                               rel_min_height = 0.005,
                               scale = 1.25,
                               size = 0.5)
g5 <- g5 + ggtitle("Movie Distribution by Audience Score and MPAA Rating")
#X-axis
g5 <- g5 + scale_x_continuous("Rotten Tomatoes Audience Score", breaks = c(0, 25, 50, 75, 100))
#Y-axis.
g5 <- g5 + scale_y_discrete(name = "", limits = c("no", " yes"),
                            labels = c("Other Rating", "Rated R"))
#Viridis Color Scheme.
g5 <- g5 + scale_fill_viridis(name = "Audience\nScore", breaks = c(0, 25, 50, 75, 100),
                              guide = guide_colorbar(label.position = "left", hjust = 1))
#Modify labels and text.
g5 <- g5 + theme(plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
                 axis.text.x = element_text(size = 12),
                 axis.title.x = element_text(size = 14, face = "bold"),
                 axis.text.y = element_text(hjust = 1, size = 12, angle = 35),
                 axis.title.y = element_text(size = 14, face = "bold"),
                 legend.text = element_text(size = 12),
                 legend.title = element_text(hjust = 0.5, size = 14, face = "bold"))
g5

#Summary Statistics.
movies_eda %>% 
    tab_cells(audience_score) %>%
    tab_cols(total(), mpaa_rating_R) %>% 
    tab_stat_unweighted_valid_n(label = "Count") %>%
    tab_stat_min() %>%
    tab_stat_median() %>%
    tab_stat_max() %>%
    tab_stat_mean %>%
    tab_stat_sd() %>%
    tab_pivot() %>% 
    set_caption("Table with Summary Statistics.")
```

### Theatrical Release Month : Oscar Season

Output : Plot and Table Summary for Oscar Season

```{r, eval = FALSE}
#Oscar Season.

#Distribution Plot.
g6 <- ggplot(movies, aes(x = audience_score, y = oscar_season))
#Densiy Ridges.
g6 <- g6 + stat_density_ridges(aes(fill = ..x..),
                               geom = "density_ridges_gradient",
                               quantile_lines = TRUE,
                               rel_min_height = 0.005,
                               scale = 1.25,
                               size = 0.5)
#Title.
g6 <- g6 + ggtitle("Movie Distribution by Audience Score and Theatrical Release Month (I)")
#X-axis
g6 <- g6 + scale_x_continuous("Rotten Tomatoes Audience Score", breaks = c(0, 25, 50, 75, 100))
#Y-axis.
g6 <- g6 + scale_y_discrete(name = "", limits = c("no", " yes"),
                            labels = c("Other Month", "Oscar Month"))
#Viridis Color Scheme.
g6 <- g6 + scale_fill_viridis(name = "Audience\nScore", breaks = c(0, 25, 50, 75, 100),
                              guide = guide_colorbar(label.position = "left", hjust = 1))
#Modify labels and text.
g6 <- g6 + theme(plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
                 axis.text.x = element_text(size = 12),
                 axis.title.x = element_text(size = 14, face = "bold"),
                 axis.text.y = element_text(hjust = 1, size = 12, angle = 35),
                 axis.title.y = element_text(size = 14, face = "bold"),
                 legend.text = element_text(size = 12),
                 legend.title = element_text(hjust = 0.5, size = 14, face = "bold"))
#Footnote.
g6 <- g6 + labs(caption = "October, November, and December are Oscar Months.")
g6

#Summary Statistics.
movies_eda %>% 
    tab_cells(audience_score) %>%
    tab_cols(total(), oscar_season) %>% 
    tab_stat_unweighted_valid_n(label = "Count") %>%
    tab_stat_min() %>%
    tab_stat_median() %>%
    tab_stat_max() %>%
    tab_stat_mean %>%
    tab_stat_sd() %>%
    tab_pivot() %>% 
    set_caption("Table with Summary Statistics.")
```

### Theatrical Release Month : Summer Season

Output : Plot and Table Summary for Summer Season

```{r, eval = FALSE}
#Summer Season.

#Distribution Plot.
g7 <- ggplot(movies, aes(x = audience_score, y = summer_season))
#Densiy Ridges.
g7 <- g7 + stat_density_ridges(aes(fill = ..x..),
                               geom = "density_ridges_gradient",
                               quantile_lines = TRUE,
                               rel_min_height = 0.005,
                               scale = 1.25,
                               size = 0.5)
#Title. 
g7 <- g7 + ggtitle("Movie Distribution by Audience Score and Theatrical Release Month (II)")
#X-axis
g7 <- g7 + scale_x_continuous("Rotten Tomatoes Audience Score", breaks = c(0, 25, 50, 75, 100))
#Y-axis.
g7 <- g7 + scale_y_discrete(name = "", limits = c("no", " yes"),
                            labels = c("Other Month", "Summer Month"))
#Viridis Color Scheme.
g7 <- g7 + scale_fill_viridis(name = "Audience\nScore", breaks = c(0, 25, 50, 75, 100),
                              guide = guide_colorbar(label.position = "left", hjust = 1))
#Modify labels and text.
g7 <- g7 + theme(plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
                 axis.text.x = element_text(size = 12),
                 axis.title.x = element_text(size = 14, face = "bold"),
                 axis.text.y = element_text(hjust = 1, size = 12, angle = 35),
                 axis.title.y = element_text(size = 14, face = "bold"),
                 legend.text = element_text(size = 12),
                 legend.title = element_text(hjust = 0.5, size = 14, face = "bold"))
#Footnote.
g7 <- g7 + labs(caption = "May, June, July, and August are Summer Months.")
g7

#Summary Statistics.
movies_eda %>% 
    tab_cells(audience_score) %>%
    tab_cols(total(), summer_season) %>% 
    tab_stat_unweighted_valid_n(label = "Count") %>%
    tab_stat_min() %>%
    tab_stat_median() %>%
    tab_stat_max() %>%
    tab_stat_mean %>%
    tab_stat_sd() %>%
    tab_pivot() %>% 
    set_caption("Table with Summary Statistics.")
```

### Numerical Predictors.

Plot : Correlation of Numerical Predictors
```{r, eval = FALSE}
numericals <- movies %>%
  select(audience_score, critics_score, imdb_rating, imdb_num_votes, runtime, thtr_rel_year)
ggcorr(numericals) + scale_fill_viridis(direction = -1)
```

* * *

## Part 4: Modeling

### Variables for Model:

Output : Predictors
```{r, eval = FALSE}
movies_2 <- movies %>%
  select(audience_score, feature_film, drama, runtime,
         mpaa_rating_R, thtr_rel_year, oscar_season,
         summer_season, critics_score, best_pic_nom,
         best_pic_win, best_actor_win, best_actress_win,
         best_dir_win, top200_box)

colnames(movies_2)[-1]
```

Standard Linear Regression
```{r, eval = FALSE}

movies_full <- lm(audience_score ~ ., data = movies_2)

summary(movies_full)
```

### Model diagnostics

Bayesian Regression
```{r, eval = FALSE}
#Regression Model.
movies.ZS <- bas.lm(audience_score ~ .,
                    data = movies_2,
                    prior = "ZS-null",
                    modelprior = uniform(),
                    method = "MCMC")
```

Plots : Diagnostics 1
```{r, eval = FALSE}
#Convergence Plot.
#Equivalent of diagnostics(movies.ZS, ask = F).
g8 <- ggplot(mapping = aes(x = movies.ZS$probne0.RN, y = movies.ZS$probne0.MCMC))
#Scatter Plot.
g8 <- g8 + geom_point(color = viridis(5)[3], size = 4, alpha = 0.5)
#y = x.
g8 <- g8 + geom_segment(aes(x = 0, y = 0, xend = 1.05, yend = 1.05), color = viridis(5)[1])
#Title. 
g8 <- g8 + ggtitle("Convergence Plot: Posterior Inclusion Probabilities")
#X-axis
g8 <- g8 + scale_x_continuous("pip (renormalized)",
                              breaks = c(0, 0.2, 0.4, 0.6, 0.8, 1.0),
                              expand = c(0,0))
#Y-axis.
g8 <- g8 + scale_y_continuous("pip (MCMC)",
                              breaks = c(0, 0.2, 0.4, 0.6, 0.8, 1.0),
                              expand = c(0,0))
#Modify labels and text.
g8 <- g8 + theme(plot.title = element_text(hjust = 0.5, size = 12, face = "bold"),
                 axis.text.x = element_text(size = 10),
                 axis.title.x = element_text(size = 12, face = "bold"),
                 axis.text.y = element_text(hjust = 1, size = 10, angle = 35),
                 axis.title.y = element_text(size = 12, face = "bold"))

#Convergence Plot.
g9 <- ggplot(mapping = aes(movies.ZS$postprobs.RN, y = movies.ZS$postprobs.MCMC))
#Scatter Plot.
g9 <- g9 + geom_point(color = viridis(5)[3], size = 4, alpha = 0.5)
#y = x.
g9 <- g9 + geom_segment(aes(x = -0.005, y = -0.005, xend = 0.2, yend = 0.2), color = viridis(5)[1])
#Title. 
g9 <- g9+ ggtitle("Convergence Plot: Posterior Model Probabilities")
#X-axis
g9 <- g9 + scale_x_continuous("p(M | Y) (renormalized)",
                              breaks = c(0, 0.05, 0.10, 0.15, 0.20),
                              expand = c(0,0))
#Y-axis.
g9 <- g9 + scale_y_continuous("p(M | Y) (MCMC)",
                              breaks = c(0, 0.05, 0.10, 0.15, 0.20),
                              expand = c(0,0))
#Modify labels and text.
g9 <- g9 + theme(plot.title = element_text(hjust = 0.5, size = 12, face = "bold"),
                 axis.text.x = element_text(size = 10),
                 axis.title.x = element_text(size = 12, face = "bold"),
                 axis.text.y = element_text(hjust = 1, size = 10, angle = 35),
                 axis.title.y = element_text(size = 12, face = "bold"))


grid.arrange(g8, g9, ncol = 2)
```

Plots : Diagnostics 2
```{r, eval = FALSE}
#Residuals and Fitted Data.
test <- predict(movies.ZS, movies_2)
temp_df <- data.frame(test$fit) %>%
  mutate(residuals = movies_2$audience_score - test$fit) %>%
  `colnames<-`(c("fitted", "residuals")) %>%
  mutate(outliers = ifelse(residuals >= 2.9*sd(residuals), "yes", "no"))

#Residuals vs Fitted Plot.
#Equivalent of plot(movies.ZS, which = 1, ask = F).
g10 <- ggplot(data = temp_df, mapping = aes(x = fitted, y = residuals))
#Scatter Plot.
g10 <- g10 + geom_point(aes(color = outliers, alpha = outliers), size = 4)
#Best Fit.
g10 <- g10 + stat_smooth(method = "lm", color = viridis(5)[1], se = FALSE)
#Title. 
g10 <- g10 + ggtitle("Residuals vs Fitted")
#X-axis
g10 <- g10 + scale_x_continuous("Predictions under BMA\nbas.lm(audience_score ~.)")
#Y-axis.
g10 <- g10 + scale_y_continuous("Residuals")
#Viridis Color Scheme
g10 <- g10 + scale_color_manual(values = c(viridis(5)[3], viridis(7)[3]))
g10 <- g10 + scale_alpha_manual(values = c(0.2, 1))
#Modify labels and text.
g10 <- g10 + theme(plot.title = element_text(hjust = 0.5, size = 12, face = "bold"),
                   axis.text.x = element_text(size = 8),
                   axis.title.x = element_text(size = 10, face = "bold"),
                   axis.text.y = element_text(hjust = 1, size = 8, angle = 35),
                   axis.title.y = element_text(size = 10, face = "bold"),
                   legend.position = "none")

#Model Probabilities Data.
temp_df <- data.frame("Probability" = movies.ZS$postprobs) %>%
  mutate(n = 1:length(movies.ZS$postprobs),
         Cumulative = cumsum(Probability))

logistic_model <- SummarizeGrowth(temp_df$n, temp_df$Cumulative)
df.pred <-  data.frame(n = 1:length(movies.ZS$postprobs),
                       Cumulative = predict(logistic_model$model))

#Model Probabilities.
#Equivalent of plot(movies.ZS, which = 2, ask = F).
g11 <- ggplot(data = temp_df, mapping = aes(x = n, y = Cumulative))
#Scatter Plot.
g11 <- g11 + geom_point(color = viridis(5)[3], size = 4, alpha = 0.5)
#Best Fit.
g11 <- g11 + geom_line(df.pred, mapping = aes(y = df.pred[, 2]), color = viridis(5)[1], size = 1.2)

#Title. 
g11 <- g11 + ggtitle("Model Probabilities")
#X-axis
g11 <- g11 + scale_x_continuous("Model Search Order by Probability\nbas.lm(audience_score ~.)")
#Y-axis.
g11 <- g11 + scale_y_continuous("Cumulative Probability")
#Modify labels and text.
g11 <- g11 + theme(plot.title = element_text(hjust = 0.5, size = 12, face = "bold"),
                   axis.text.x = element_text(size = 8),
                   axis.title.x = element_text(size = 10, face = "bold"),
                   axis.text.y = element_text(hjust = 1, size = 8, angle = 35),
                   axis.title.y = element_text(size = 10, face = "bold"))

#Model Complexity Data.
temp_df <- data.frame("logmarg" = movies.ZS$logmarg,
                      "size" = movies.ZS$size)
#Model Complexity.
#Equivalent of plot(movies.ZS, which = 3, ask = F).
g12_1 <- ggplot(data = temp_df %>% filter(logmarg > 75), mapping = aes(x = size, y = logmarg))
g12_2 <- ggplot(data = temp_df %>% filter(logmarg < 75), mapping = aes(x = size, y = logmarg))

#Scatter Plot.
g12_1 <- g12_1 + geom_point(color = viridis(5)[3], size = 4, alpha = 0.3)
g12_2 <- g12_2 + geom_point(color = viridis(5)[3], size = 4, alpha = 0.3)
#Title. 
g12_1 <- g12_1 + ggtitle("Model Complexity")
#X-axis.
g12_1 <- g12_1 + scale_x_continuous(limits = c(0, 11),
                                    breaks = c(0, 2, 4, 6, 8, 10))
g12_2 <- g12_2 + scale_x_continuous("Model Dimension\nbas.lm(audience_score ~.)",
                                    limits = c(0, 11),
                                    breaks = c(0, 2, 4, 6, 8, 10))
#Y-axis.
g12_1 <- g12_1 + scale_y_continuous("log(Marginal)")
g12_2 <- g12_2 + scale_y_continuous("", breaks = c(0, 30, 60))
#Modify labels and text.
g12_1 <- g12_1 + theme(plot.title = element_text(hjust = 0.5, size = 12, face = "bold"),
                       axis.text.x = element_blank(),
                       axis.ticks.x = element_blank(),
                       axis.title.x = element_blank(),
                       axis.text.y = element_text(hjust = 1, size = 8, angle = 35),
                       axis.title.y = element_text(hjust = 0, size = 10, face = "bold"))

g12_2 <- g12_2 + theme(plot.title = element_blank(),
                       axis.text.x = element_text(size = 8),
                       axis.title.x = element_text(size = 10, face = "bold"),
                       axis.text.y = element_text(hjust = 1, size = 8, angle = 35),
                       panel.grid.minor.y = element_blank(),
                       axis.title.y = element_text(size = 10, face = "bold"))

g12 <- arrangeGrob(g12_1, g12_2, layout_matrix = matrix(c(1,1,2), ncol = 1))

#Inclusion Probabilities Data.
temp_df <- data.frame("Predictor" = factor(movies.ZS$names),
                      "Probability" = movies.ZS$probne0) %>%
   mutate(Predictor = fct_rev(fct_relevel(Predictor, movies.ZS$names)),
         Highlight = ifelse(Probability > 0.6, "yes", "no"))
#Inclusion Probabilities.
#Equivalent of plot(movies.ZS, which = 4, ask = F).
g13 <- ggplot(data = temp_df, mapping = aes(x = Probability, y = Predictor))
#Horizontal Lines.
g13 <- g13 + geom_segment(aes(x = 0, y = Predictor,
                              xend = Probability, yend = Predictor,
                              color = Highlight, size = Highlight))
#Title. 
g13 <- g13 + ggtitle("Inclusion Probabilities")
#X-axis
g13 <- g13 + scale_x_continuous("Marginal Inclusion Probability")
#Y-axis.
g13 <- g13 + scale_y_discrete("bas.lm(audience_score ~.)")
#Viridis Color Scheme.
g13 <- g13 + scale_color_manual(values = c(viridis(5)[1], viridis(5)[3]))
#Scale Size.
g13 <- g13 + scale_size_manual(values = c(1, 3))
#Y-axis labels.
fontcolor <- rev(ifelse(temp_df$Highlight == "yes", viridis(5)[3], viridis(5)[1]))
fontface <- rev(ifelse(temp_df$Highlight == "yes", "bold", "plain"))
#Modify labels and text.
g13 <- g13 + theme(plot.title = element_text(hjust = 0.5, size = 12, face = "bold"),
                   axis.text.x = element_text(size = 8),
                   axis.title.x = element_text(size = 10, face = "bold"),
                   axis.text.y = element_text(hjust = 1, size = 8, angle = 35,
                                              color = fontcolor, face = fontface),
                   axis.title.y = element_text(size = 10, face = "bold"),
                   legend.position = "none")

grid.arrange(g10, g11, g12, g13,
             layout_matrix = matrix(rbind(c(1, 1, 1, 1, 1, NA, 2, 2, 2, 2, 2),
                                          c(3, 3, 3, 3, 3, NA, 4, 4, 4, 4, 4)),
                                    ncol = 11))
```

Image : Top 20 Models
```{r, eval = FALSE}
#Variables in Best Models.
image(movies.ZS, rotate = F)
```

Output : Marginal Inclusion Probabilities and Top 5 Models
```{r, eval = FALSE}
summary(movies.ZS)
```

### Interpretation of Model Coefficients

Output : Coefficients and Intervals
```{r, eval = FALSE}
confint(coef(movies.ZS))
```

* * *

## Part 5: Prediction

Deadpool data 
```{r, eval = FALSE}
#Deadpool data from https://www.rottentomatoes.com/m/deadpool.

deadpool <- data.frame("audience_score" = 90,
                       "feature_film" = " yes",
                       "drama" = "no",
                       "runtime" = 108,
                       "mpaa_rating_R" = " yes",
                       "thtr_rel_year" = 2016,
                       "oscar_season" = "no",
                       "summer_season" = "no",
                       "critics_score" = 85,
                       "best_pic_nom" = "no",
                       "best_pic_win" = "no",
                       "best_actor_win" = "no",
                       "best_actress_win" = "no",
                       "best_dir_win" = "no",
                       "top200_box" = "yes")
```

BPM Output
```{r, eval = FALSE}
BPM <- predict(movies.ZS, newdata = deadpool, estimator = "BPM", interval = "prediction", se.fit = TRUE)
confint(BPM)
variable.names(BPM)
```

HPM Output
```{r, eval = FALSE}
HPM <- predict(movies.ZS, newdata = deadpool, estimator = "HPM", interval = "prediction", se.fit = TRUE)
confint(HPM)
variable.names(HPM)
```
